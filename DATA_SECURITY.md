# MSDS数据库安全说明

## 🔒 数据安全架构

### 1. 数据存储方式
- **本地存储**：所有MSDS数据存储在用户浏览器的IndexedDB中
- **无后端传输**：数据不会上传到任何服务器
- **用户隔离**：每个用户的浏览器拥有独立的数据库实例

### 2. 管理权限控制

#### 数据导入权限
- **管理页面访问**：`msds-admin.html` 仅在本地环境可访问
- **生产环境隐藏**：部署到生产环境时，管理页面不对外开放
- **数据预加载**：通过以下方式预置数据：
  ```
  1. 本地导入Excel数据
  2. 导出IndexedDB数据为JSON
  3. 将JSON数据推送到代码库
  4. 生产环境自动加载预置数据
  ```

#### 权限分级
| 功能 | 本地开发 | 生产环境 |
|------|---------|---------|
| 查询MSDS | ✓ | ✓ |
| 导入数据 | ✓ | ✗ |
| 导出PDF | ✓ | ✓ |
| 批量操作 | ✓ | ✗ |
| 删除数据 | ✓ | ✗ |

### 3. 生产环境部署方案

#### 方案A：预置数据打包
```bash
# 步骤1：本地导入完整数据
# 访问 http://localhost/msds-admin.html
# 导入所有Excel批次

# 步骤2：导出数据库
# 使用浏览器开发工具导出IndexedDB

# 步骤3：转换为初始化脚本
node scripts/generate-init-data.js

# 步骤4：推送到代码库
git add js/msds-init-data.js
git commit -m "feat: 更新MSDS数据库"
git push origin main
```

#### 方案B：删除管理页面
```bash
# 生产环境删除管理入口
rm msds-admin.html  # 或在部署时排除此文件
```

### 4. 数据更新流程

```mermaid
graph LR
    A[本地Excel文件] --> B[本地浏览器导入]
    B --> C[IndexedDB存储]
    C --> D[导出JSON数据]
    D --> E[推送到Git仓库]
    E --> F[生产环境自动加载]
    F --> G[用户查询使用]
```

### 5. 安全检查清单

#### 部署前检查
- [ ] 确认 `msds-admin.html` 未包含在生产构建中
- [ ] 验证管理功能无法从生产URL访问
- [ ] 确认预置数据已正确打包
- [ ] 测试查询功能正常工作
- [ ] 验证PDF导出功能可用

#### 代码安全
- [ ] 管理页面不包含敏感信息
- [ ] 不存在硬编码的管理密码
- [ ] 无未授权的数据访问接口
- [ ] IndexedDB操作有完整的错误处理

### 6. 技术实现细节

#### 查询页面（公开访问）
```javascript
// msds-search.html - 仅包含查询功能
- 搜索化学品
- 查看MSDS详情
- 导出单个PDF
```

#### 管理页面（本地专用）
```javascript
// msds-admin.html - 仅本地访问
- Excel批量导入
- 高级搜索
- 批量导出PDF
- 批量删除
- 数据库清空
```

### 7. 数据备份建议

```bash
# 定期备份IndexedDB数据
# 方式1：使用浏览器开发工具导出
# 方式2：使用自定义导出脚本

# 备份存储位置
backups/
├── msds-backup-2025-01-15.json
├── msds-backup-2025-02-01.json
└── msds-backup-2025-03-01.json
```

### 8. 常见问题

**Q: 用户数据会丢失吗？**
A: IndexedDB数据存储在用户本地，除非用户清除浏览器数据，否则会永久保存。

**Q: 如何更新生产环境的数据？**
A: 在本地更新数据后，导出为JSON，推送到代码库，重新部署即可。

**Q: 是否支持多用户协作？**
A: 当前架构为单用户本地存储，不支持多用户协作。如需协作，建议使用后端数据库方案。

**Q: 数据会被其他网站访问吗？**
A: 不会。IndexedDB遵循同源策略，只有当前域名可以访问自己的数据。

---

## 📝 生产环境配置示例

### `.gitignore` 配置
```bash
# 开发时使用的管理页面（可选，如果不想上传）
# msds-admin.html

# 临时数据文件
*.tmp.json
backups/*.json
```

### 部署配置（Nginx示例）
```nginx
# 禁止访问管理页面
location /msds-admin.html {
    deny all;
    return 404;
}

# 允许访问查询页面
location /msds-search.html {
    allow all;
}
```

---

## ✅ 总结

这种架构确保了：
1. ✓ **数据安全**：用户数据存储在本地，不经过服务器
2. ✓ **权限控制**：管理功能仅限本地使用
3. ✓ **部署简单**：预置数据随代码一起部署
4. ✓ **可维护性**：数据更新通过Git版本控制
5. ✓ **用户体验**：查询功能完全可用，响应迅速
